<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
                                                          
     ====================================================================== -->
<project name="org.talend.mdm.commmon" xmlns:artifact="antlib:org.apache.maven.artifact.ant" default="all">

    <property file="build_server.properties" />

    <target name="prepare-maven" if="local.developer.build">
        <path id="maven-ant-tasks.classpath" path="${maven.ant.tasks.file}" />
        <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="antlib:org.apache.maven.artifact.ant" classpathref="maven-ant-tasks.classpath" />
    </target>

    <property name="mdm.build.version" value="${major}.${minor}.${rev}-r${svn.revision}" />
    <property name="build.dir" value="${basedir}/target" />
    <property name="jboss.dir" value="/home/pascal/dev/jboss/jboss-4.2.2.GA-mdm/" />
    <property name="jboss.instance.dir" value="${jboss.dir}/server/default" />
    <property name="jboss.deploy.dir" value="${jboss.instance.dir}/deploy" />
    <property name="jboss.lib.dir" value="${jboss.instance.dir}/lib" />
    <property name="jboss.bin.dir" value="${jboss.dir}/bin" />

    <property name="lib" value="z.mdm.common.lib.jar" />

    <!-- ================================= 
          target: all              
         ================================= -->
    <target name="all" depends="package,undeploy,deploy" />

    <target name="clean">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="clean" />
        </antcall>
    </target>

    <target name="package">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="package" />
        </antcall>
        <copy file="${build.dir}/org.talend.mdm.commmon-${mdm.build.version}.jar" tofile="${lib}" />
    </target>

    <target name="install">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="install" />
        </antcall>
    </target>

    <target name="undeploy" description="remove packages">
        <delete file="${jboss.lib.dir}/${lib}" />
    </target>

    <target name="deploy">
        <copy file="${lib}" tofile="${jboss.lib.dir}/${lib}" />
    </target>

    <target name="mvn.invoke" description="invokes maven" depends="prepare-maven">
        <property environment="env" />
        <artifact:mvn pom="pom.xml" mavenHome="${env.M2_HOME}" fork="true" failonerror="true">
            <arg value="-V" />
            <arg value="-Dmdm.build.dir=${build.dir}" />
            <arg value="-Dmdm.build.version=${mdm.build.version}" />
            <arg value="${mvn.goal}" />
        </artifact:mvn>
    </target>

</project>
