<?xml version="1.0" encoding="UTF-8"?>
<project name="b2een" default="generate.installer">
	
	<property name="jboss.dir" value="/opt/jboss"/>
	<property name="tmp.dir" value="/tmp/nsis"/>	
	
	<target name="clean">
   		<!-- clean up temporary directory -->		
		<delete dir="${tmp.dir}"/>
   		<!-- make temporary directory -->
   		<mkdir dir="${tmp.dir}"/>
	</target>
	

	<target name="generate.installer" depends="clean">	
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="${jboss.dir}">
   				<include name="**/*.*"/>
   				<exclude name="**/*.sh"/>
   			</fileset>
   		</copy>
		<unjar dest="${tmp.dir}/openMDM" src="src/resources/jre-1.5.0_windows.zip"></unjar>
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="build">
   				<include name="*.exe"/>
   			</fileset>
   		</copy>
   		<copy todir="${tmp.dir}/openMDM">
   			<fileset dir="src/resources">
   				<include name="License.txt"/>
   			</fileset>
   		</copy>
		
		<!-- build -->
		<antcall target="windows.nsis"/>
		
		<!-- final -->
		<copy todir=".">
			<fileset dir="${tmp.dir}">
			   	<include name="*.exe"/>
  			</fileset>
   		</copy>
		<antcall target="clean"/>
	</target>
	
	<target name="windows.nsis">
   		<copy todir="${tmp.dir}">
   			<fileset dir="src/scripts">
   				<include name="openMDM_installer.nsi"/>
   			</fileset>
   			<fileset dir="src/resources">
   				<include name="logo-openMDM.bmp"/>
   				<include name="mdm_installer.ico"/>
   				<include name="mdm_uninstaller.ico"/>
   			</fileset>
   		</copy>
		<!-- run makensi -->
		<exec executable="/opt/local/var/macports/software/nsis/2.39_0/nsis-2.39/bin/makensis">
			<arg value="-V4"/>
			<arg value="${tmp.dir}/openMDM_installer.nsi"/>
		</exec>
	</target>
	
	<target name="generate.openMDM.exe">
		<!-- run makensi -->
		<exec executable="/opt/local/var/macports/software/nsis/2.39_0/nsis-2.39/bin/makensis">
			<arg value="src/scripts/JavaLauncher.nsi"/>
		</exec>
	</target>	
	

</project>

